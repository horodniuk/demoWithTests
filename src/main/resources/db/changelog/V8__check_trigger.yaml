databaseChangeLog:
  - changeSet:
      id: createCheckEmployeesCountryFunction
      author: horodniuk
      changes:
        - sql:
            dbms: postgresql
            endDelimiter: ;;
            splitStatements: true
            sql: >
              CREATE OR REPLACE FUNCTION check_employees_country()
              RETURNS TRIGGER AS $$
              BEGIN
                  IF NEW.country IS NULL THEN
                      RAISE EXCEPTION 'Country cannot be null';
                  END IF;
                  RETURN NEW;
              END;
              $$ LANGUAGE plpgsql;

  - changeSet:
      id: createTriggerUserCountryNull
      author: horodniuk
      changes:
        - sql:
            dbms: postgresql
            endDelimiter: ;;
            splitStatements: true
            sql: >
              CREATE TRIGGER trigger_user_country_null
                  BEFORE INSERT OR UPDATE ON liquibase.users
                  FOR EACH ROW
              EXECUTE FUNCTION check_employees_country();